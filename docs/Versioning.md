# Record Layer Versions

## Variants

The Record Layer is released in several variants, depending on which version of the Protobuf API is used and whether or not Protobuf is renamed ("shaded").

|              |         Protobuf 2             |         Protobuf 3                 |
|:------------:|:------------------------------:|:----------------------------------:|
| **Unshaded** | `fdb-record-layer-core`        | `fdb-record-layer-core-pb3`        |
| **Shaded**   | `fdb-record-layer-core-shaded` | `fdb-record-layer-core-pb3-shaded` |

In the shaded versions, `com.google` classes will be renamed to `com.apple.foundationdb.record.shaded.com.google`.

Code generated by one version of `protoc` is generally *not* compatible with the Protobuf runtime classes from another version.

### Maven Dependency

```
  <groupId>org.foundationdb</groupId>
  <artifactId>fdb-record-layer-core</artifactId>
  <version>2.4.+</version>
```

### Gradle Dependency

```
"org.foundationdb:fdb-record-layer-core:2.4.+"
```

## Semantic Versioning

Record Layer versions are *major*.minor*.*build*.*patch*.

*patch* is `0` for normal releases and increments only when a side branch is created to fix problems with an older release.

## API Stability Annotations

Classes and methods annotations using `@API` determine when they can be changed in a backwards-incompatible way or removed. See the [Javadoc](https://javadoc.io/page/org.foundationdb/fdb-extensions/latest/com/apple/foundationdb/API.html) for more details.

* `STABLE` will not change until the major version is incremented. At that time, they may also change status to something less stable.

* `MAINTAINED` will not change until the minor version is incremented. At that time, only the status changes to `UNSTABLE` or `DEPRECATED`. This indicates that in the *next* minor version they will change / be removed.

* `UNSTABLE` can change in a minor release without other advance notice.

* `DEPRECATED` can be removed in a minor release without other advance notice.

* `EXPERIMENTAL` can change / be removed in any build without notice.


## Creating a Patch Branch

* Patch branches should be named `fdb-record-layer-a.b.c` after the build from which they are created.

* The new patch branch should be made using the tag created for the starting build.

    ```
    git checkout -b fdb-record-layer-a.b.c a.b.c.0
    ```

* In `gradle.properties`, change

    ```
    version=a.b
    ```

    to

    ```
    version=a.b.c
    ```

    using the starting version.

* In `docs/ReleaseNotes.md`, move the template for release notes for the next release to be just above the release note for the starting version `a.b.c`.

* Commit and push the new branch upstream.

* Create patch fix pull requests against this new branch.

* There may be conflicts in the `gradle.properties` and `docs/ReleaseNotes.md` files when the patch branch is merged into master. Be sure whenever merging that branch in that (1) the version on master is not accidentally changed and (2) the release notes file contains all release notes from both branches after the merge.
