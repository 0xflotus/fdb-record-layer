# Record Layer Versions

## Variants

The Record Layer is released in several variants, depending on which version of the Protobuf API is used and whether or not Protobuf is renamed ("shaded").

|              |         Protobuf 2             |         Protobuf 3                 |
|:------------:|:------------------------------:|:----------------------------------:|
| **Unshaded** | `fdb-record-layer-core`        | `fdb-record-layer-core-pb3`        |
| **Shaded**   | `fdb-record-layer-core-shaded` | `fdb-record-layer-core-pb3-shaded` |

In the shaded versions, `com.google` classes will be renamed to `com.apple.foundationdb.record.shaded.com.google`.

Code generated by one version of `protoc` is generally *not* compatible with the Protobuf runtime classes from another version.

### Maven Dependency

```
  <groupId>org.foundationdb</groupId>
  <artifactId>fdb-record-layer-core</artifactId>
  <version>2.2.+</version>
```

### Gradle Dependency

```
"org.foundationdb:fdb-record-layer-core:2.2.+"
```

## Semantic Versioning

Record Layer versions are *major*.minor*.*build*.*patch*.

*patch* is `0` for normal releases and increments only when a side branch is created to fix problems with an older release.

## API Stability Annotations

Classes and methods annotations using `@API` determine when they can be changed in a backwards-incompatible way or removed. See the [Javadoc](https://javadoc.io/page/org.foundationdb/fdb-extensions/latest/com/apple/foundationdb/API.html) for more details.

* `STABLE` will not change until the major version is incremented. At that time, they may also change status to something less stable.

* `MAINTAINED` will not change until the minor version is incremented. At that time, only the status changes to `UNSTABLE` or `DEPRECATED`. This indicates that in the *next* minor version they will change / be removed.

* `UNSTABLE` can change in a minor release without other advance notice.

* `DEPRECATED` can be removed in a minor release without other advance notice.

* `EXPERIMENTAL` can change / be removed in any build without notice.


## Creating a Patch Branch

* Patch branches should be named `fdb-record-layer-n.n.n` after the build from which they are created.

* The new patch branch should be made using the tag created for the starting build.

    ```
    git checkout -b fdb-record-layer-2.3.4 2.3.4.0
    ```

* In `gradle.properties`, change

    ```
    version=n.n
    ```

    to

    ```
    version=n.n.n
    ```

    using the starting version.

* In `docker-compose.yaml`, change

    ```
    RECORD_LAYER_BUILD_NUMBER=${BUILD_NUMBER}.0
    ```

    to

    ```
    RECORD_LAYER_BUILD_NUMBER=${BUILD_NUMBER}
    ```

    so that each build increments the patch version.

* Commit and push the new branch upstream.

* Create patch fix pull request against this new branch.
